<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../../lib/fontawesome/css/all.css">
    <link rel="stylesheet" href="../../css/layout/user-info.css">
    <link rel="stylesheet" href="../../css/main.css">
</head>

<body>
    <div class="info-header">
        <a href="../../index.html">
            <i class="fas fa-shield-virus"></i>
            <h5>ANTI COVID</h5>
        </a>
        <h5>Thông tin y tế người dân</h5>
    </div>
    <div class="info-body">
        <div class="user-info">
            <b>Thông tin cá nhân</b>
            <ul>

            </ul>
        </div>
        <div class="domesticguest">
            <b>Khai báo toàn dân</b>
            <ul>
            </ul>
        </div>
        <div class="movedeclaration">
            <b>Khai báo di chuyển</b>
            <ul>

            </ul>
        </div>
        <div class="entrydeclaration">
            <b>Khai báo nhập cảnh</b>
            <ul>

            </ul>
        </div>
    </div>


    <script src="../../js/common/common.js"></script>
    <script>
        const decipher = salt => {
            const textToChars = text => text.split('').map(c => c.charCodeAt(0));
            const applySaltToChar = code => textToChars(salt).reduce((a, b) => a ^ b, code);
            return encoded => encoded.match(/.{1,2}/g)
                .map(hex => parseInt(hex, 16))
                .map(applySaltToChar)
                .map(charCode => String.fromCharCode(charCode))
                .join('');
        }

        window.onload = () => {
            var url = new URL(window.location.href);
            var phoneEncrypt = url.searchParams.get("phoneNumber");
            console.log(phoneEncrypt);
            const myDecipher = decipher('mySecretSalt');
            var phoneNumber = myDecipher(phoneEncrypt);
            console.log(phoneNumber);
            const options = {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            };

            fetch(`https://n8-covid-be.herokuapp.com/qrcode/getUserInfoByPhoneNumber?phoneNumber=${phoneNumber}`, options).then(res => {
                if (res.ok) {
                    return res.json();
                } else {
                    return Promise.reject(res);
                }
            }).then(res => {
                console.log(res.data[0]);
                var userInfo = document.querySelector('.user-info ul');
                var domesticguest = document.querySelector('.domesticguest ul');
                var movedeclaration = document.querySelector('.movedeclaration ul');
                var entrydeclaration = document.querySelector('.entrydeclaration ul');
                userInfo.append(insertInfo("Họ và tên", res.data[0].info.fullName));
                userInfo.append(insertInfo("Ngày sinh", formatDate(res.data[0].info.dateOfBirth)));
                userInfo.append(insertInfo("Giới tính", res.data[0].info.Sex));
                userInfo.append(insertInfo("Số điện thoại", res.data[0].phoneNumber));
                userInfo.append(insertInfo("Đơn vị", res.data[0].unitDetail));
                userInfo.append(insertInfo("Quốc tịch", res.data[0].info.nationality));
                userInfo.append(insertInfo("Tình trạng", res.data[0].info.diseaseStatus));
                if (res.data[0].domesticguest.length == 1) {
                    let data = res.data[0].domesticguest[0];
                    domesticguest.append(insertInfo("Có đi qua vùng bệnh không", data.ismovingThroughTerritory));
                    domesticguest.append(insertInfo("Có dấu hiệu mắc Covid không", data.nCoVSignal));
                    domesticguest.append(insertInfo("Có tiếp xúc với người bệnh hoặc nghi ngờ không", data.patientContact));
                    domesticguest.append(insertInfo("Có tiếp xúc với người từ nước có Covid không", data.nCoVConPCountry));
                    domesticguest.append(insertInfo("Có tiếp xúc với người có dấu hiệu mắc nCoV", data.nCoVConPSignal));
                } else {
                    domesticguest.append(insertInfo("Không có thông tin!", ""));
                }
                if (res.data[0].domesticmovedeclaration.length == 1) {
                    let data = res.data[0].domesticmovedeclaration[0];
                    movedeclaration.append(insertInfo("Phương tiện", data.vehicle));
                    movedeclaration.append(insertInfo("Số hiệu phương tiện", data.vehicleNumber));
                    movedeclaration.append(insertInfo("Số ghế", data.chairNumber));
                    movedeclaration.append(insertInfo("Ngày khởi hành", data.departureDay));
                    movedeclaration.append(insertInfo("Địa chỉ xuất phát", data.departureAddress));
                    movedeclaration.append(insertInfo("Địa chỉ đến", data.arrivalAddress));
                    movedeclaration.append(insertInfo("Có di chuyển qua quốc gia lãnh thổ nào", data.ismovingThroughTerritory));
                    movedeclaration.append(insertInfo("Có dấu hiệu mắc nCoV", data.nCoVSignal));
                    movedeclaration.append(insertInfo("Có tiếp xúc với người bênh hoạc nghi ngờ", data.patientContact));
                    movedeclaration.append(insertInfo("Có tiếp xúc với người từ nước có nCoV", data.nCoVConPCountry));
                    movedeclaration.append(insertInfo("Có tiếp xúc với người có dấu hiệu mắc nCoV", data.nCoVConPSignal));
                    movedeclaration.append(insertInfo("Ngày khai báo", data.declarationDate));

                } else {
                    movedeclaration.append(insertInfo("Không có thông tin!", ""));
                }
                if (res.data[0].entrydeclaration.length == 1) {
                    let data = res.data[0].entrydeclaration[0];
                    entrydeclaration.append(insertInfo("Đối tượng", data.object));
                    entrydeclaration.append(insertInfo("Cửa khẩu", data.gate));
                    entrydeclaration.append(insertInfo("Phương tiện", data.vehicle));
                    entrydeclaration.append(insertInfo("Số hiệu phương tiện", data.vehicleNumber));
                    entrydeclaration.append(insertInfo("Số ghế", data.chairNumber));
                    entrydeclaration.append(insertInfo("Ngày khởi hành", data.departureDay));
                    entrydeclaration.append(insertInfo("Ngày nhập cảnh", data.entryDate));
                    entrydeclaration.append(insertInfo("Quốc gia khởi hành", data.departureCountry));
                    entrydeclaration.append(insertInfo("Thành phố khởi hành", data.departureCity));
                    entrydeclaration.append(insertInfo("Quốc gia cần đến", data.destinationCountry));
                    entrydeclaration.append(insertInfo("Đã đi qua quốc gia nào", data.passingCountry));
                    entrydeclaration.append(insertInfo("Địa chỉ lưu trú sau cách ly tập trung", data.addressAfterQuarantine));
                    entrydeclaration.append(insertInfo("Ho ", data.fever));
                    entrydeclaration.append(insertInfo("Sốt ", data.cough));
                    entrydeclaration.append(insertInfo("Khó thở", data.stuffy));
                    entrydeclaration.append(insertInfo("Đau họng", data.soreThroat));
                    entrydeclaration.append(insertInfo("Nôn", data.nausea));
                    entrydeclaration.append(insertInfo("Tiêu chảy", data.diarrhea));
                    entrydeclaration.append(insertInfo("Xuất huyết", data.hemorrhage));
                    entrydeclaration.append(insertInfo("Nổi ban", data.rash));
                    entrydeclaration.append(insertInfo("Loại Vacxin đã sử dụng", data.vaccinesUsed));
                    entrydeclaration.append(insertInfo("Có tiếp xúc với động vật hay cơ sở giết mổ", data.animalContact));
                    entrydeclaration.append(insertInfo("Có tiếp xúc với người mắc nCoV", data.nCoVPContact));
                    entrydeclaration.append(insertInfo("Cơ sở cách ly", data.isolationFacility));
                    entrydeclaration.append(insertInfo("Xác nhận âm tính", data.negativeConfirmation));
                } else {
                    entrydeclaration.append(insertInfo("Không có thông tin!", ""));
                }
            })
        }

        function insertInfo(title, content) {
            var li = parseHTML(`<li> <p><b>${title}: </b>${content}</p> </li>`);
            return li;
        }

        function formatDate(_date) {
            if (_date != null) {
                var date = new Date(_date);
                var day = date.getDate();
                day = (day < 10) ? '0' + day : day;
                var month = date.getMonth() + 1;
                month = (month < 10) ? '0' + month : month;
                var year = date.getFullYear();
                return day + '/' + month + '/' + year;
            }
            else {
                return '';
            }
        }
    </script>
</body>

</html>